<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8>
  <meta name=viewport content="width=device-width, initial-scale=1.0">
  <meta name=description content="Personal website and blog of Umanga Bista">

  <title>
    
    Robust Statistic based Streaming Anomaly Detection Scheme for Time-Series Data | 
    
    Umanga Bista
  </title>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
  </script>

  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50991800-1', 'bistaumanga.com.np');
  ga('send', 'pageview');

  </script>

  <link rel=stylesheet type=text/css href=/css/github.css>
  <link rel=stylesheet type=text/css href=/css/styles.css>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel=stylesheet type=text/css href=/css/pure-min.css>
</head>

<body>


    <div class="top-bar pure-g">
      <div class=pure-u-1-3>
        <a href="http://bistaumanga.com.np">
          <img id="logo" src="/images/logo.svg" alt="" />
        </a>
      </div>

      <div class=pure-u-1-3>
        
      </div>

      <div class=pure-u-1-3>
        <div class="pure-menu pure-menu-open pure-menu-horizontal">
          <ul>
            <li class="pure-menu-selected"><a href="/"><h4><i class="fa fa-home fa-3x"></i> </h4></a></li>
            <li class="pure-menu-selected"><a href="/blog"><h4><i class="fa fa-pencil fa-3x"></i></h4></a></li>
            <li class="pure-menu-selected"><a href="/publications"><h4><i class="fa fa-file-text fa-3x"></i></h4></a></li>
            <li class="pure-menu-selected"><a href="/about"><h4><i class="fa fa-info fa-3x"></i></h4></a></li>
          </ul>
        </div>
      </div>
    </div>


  <div class="container pure-g">
    <div class=pure-u-4-5>
      <div class=right-column>
        <div class=post>
    
    <ul class=post-meta>
    
        
    
    <li class=publish-time><i class=icon-calendar></i>May 13, 2014</li>
    
        <li>&middot;</li>
        <li><a href="/tags/#robust-statistic,-ref">#robust-statistic,</a></li>
    
        <li>&middot;</li>
        <li><a href="/tags/#anomaly-detection,-ref">#anomaly-detection,</a></li>
    
        <li>&middot;</li>
        <li><a href="/tags/#time-series,-ref">#time-series,</a></li>
    
        <li>&middot;</li>
        <li><a href="/tags/#streaming-algorithm-ref">#streaming-algorithm</a></li>
    
</ul>

    <h1 class=title-large>Robust Statistic based Streaming Anomaly Detection Scheme for Time-Series Data</h1>
    <div class=content>
        <br>
        <script src="//platform.linkedin.com/in.js" type="text/javascript">
        lang: en_US
        </script>
        <script type="IN/Share" data-counter="right"></script>
        <div class="g-plus" data-action="share" data-height="24"></div>
        <div class="fb-like" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>

        

        <p>Identifying the anomalous observations in time series data can be very important for <a href="http://en.wikipedia.org/wiki/Siem">SIEM</a> solutions. An example is a system that tracks the records of number of user-logins per minute. The anomalous entries in this case can be when the count becomes unexpecteadly higher or lower than normal trend.</p>

<p>This can be detected by simpler approach such as standard deviation method, i.e. an entry in time-series is anomaly when its not in range <strong>$ [\mu - k * \sigma, \mu + k * \sigma] $</strong>. The typical value of <strong>$ k $</strong> is <strong>3, 3.5, 4</strong>, which has to be set manually. There are three problems with this approach. The problems and the possible solutions are enumerated below:</p>

<ul>
  <li>the statistics $ \mu $ and $ \sigma $ both are not robust, outliers have huge affect on them.</li>
</ul>

<blockquote>
  <p>We have to use roubust statistics such as <strong>$ M_d $</strong>:[Median], <strong>$ IQR $</strong> :[Inter Quartile Range], in favour of <strong>$ \mu $</strong> and <strong>$ \sigma $</strong>. The time series should be smoothened by <strong><a href="http://en.wikipedia.org/wiki/Causal_system">causal</a></strong> version of <strong>Moving Median</strong> or <strong>Causal 1-D Moving Median Filter</strong>.</p>
</blockquote>

<ul>
  <li>It does not captures the trend, i.e. What if the distribution of the time-series data is  multimodal.</li>
</ul>

<blockquote>
  <p>We have to capture the trend. One way to do this is smooth the time series signal, and model the residual for anomaly detection. The residual will have $ \mu = 0 $ and some standard deviation.</p>
</blockquote>

<ul>
  <li>Anomalous time-series entries have to be identified in real-time, so we cannot use batch algorithms that calculates the parameters <em>$ \mu, \sigma $</em> in first pass and filters out the anomalous data in second pass. But this can be solved by streaming algorithm for $ \mu, \sigma $ <a href="#knuth2">(Knuth, 1998, p. 232)</a>.</li>
</ul>

<blockquote>
  <p>But since we are using robust statistics <em>$ [M_d, IQR] $</em>, we have to use streaming version of that. Luckily, there exist an awesome algorithms for this : <strong>QDigest</strong> <a href="#qdigest">(Shrivastava, Buragohain, Agrawal, &amp; Suri, 2004)</a> and <strong>TDigest</strong> <a href="#tdigest">(Dunning, 2014)</a>.</p>
</blockquote>

<p>Using these concepts to decide whether a data from real-time is an anomaly or not, we first predict
the value using Causal Moving Median algorithm. Then the residual, which is a difference between predicted and observed value is used to compute the Streaming $ M_d,  IQR $. These Robust statistics are used to estimate the robust $ \mu , \sigma $ using Equations [<a href="http://en.wikipedia.org/wiki/Robust_measures_of_scale#Estimation">wiki : Robust Scale Estimation</a>]:</p>

<script type="math/tex; mode=display">
\mu = M_d \\
\sigma = 0.74 * IQR
</script>

<p>With these estimates for robust mean and standard deviation, we will calculate the two-tailed $p-value$ as :</p>

<script type="math/tex; mode=display"> p_{value} = 1 - Erf \frac{\mid residual - \mu  \mid}{2\sigma^2} </script>

<p>and we can give the score to anomalous entries as <a href="#pvalprelert">(Thomas J. Veasey, n.d.)</a>:</p>

<script type="math/tex; mode=display"> anomaly\_score = - \log{p_{value}} </script>

<!--- So, Let us use overall Discussion to sketch an algorithm for real time Anomaly Detection in time-series data.
![png](/files/tsanomaly/algorithm.png) -->

<h2 id="results">Results</h2>
<p>Here are the results of algorithm for time series datasets with</p>

<h4 id="trend">Trend</h4>
<p><img src="/images/tsanomaly/trend.png" alt="png" /></p>

<h4 id="seasonality">Seasonality</h4>
<p><img src="/images/tsanomaly/sin.png" alt="png" /></p>

<h4 id="trend-and-seasonality">Trend and Seasonality</h4>
<p><img src="/images/tsanomaly/sintrend.png" alt="png" /></p>

<h4 id="level-shift">Level Shift</h4>
<p><img src="/images/tsanomaly/shift.png" alt="png" /></p>

<p>The results shows that the algorithm was able to detect the anomalous entries in a time series with trend or seasonality or both or Level shifts.</p>

<h2 id="references">References</h2>
<ol class="bibliography" style="font-size:12pt; text-align:left;"><li><span id="knuth2">Knuth, D. (1998). <i>The Art of Computer Programming</i> (3rd ed., Vol. II - Seminumerical Algorithms). Addison Wesley Longman. Retrieved from http://www.amazon.com/gp/product/0201896842/104-5257411-2220725?ie=UTF8&amp;tag=theende-20&amp;linkCode=xm2&amp;camp=1789&amp;creativeASIN=0201896842</span></li>
<li><span id="qdigest">Shrivastava, N., Buragohain, C., Agrawal, D., &amp; Suri, S. (2004). Medians and Beyond: New Aggregation Techniques for Sensor Networks. In <i>Proceedings of the 2Nd International Conference on Embedded Networked Sensor Systems</i> (pp. 239â€“249). New York, NY, USA: ACM. doi:10.1145/1031495.1031524</span></li>
<li><span id="tdigest">Dunning, T. (2014). Computing Extremely Accurate Quantiles Using t-Digests. Retrieved from https://github.com/tdunning/t-digest</span></li>
<li><span id="pvalprelert">Thomas J. Veasey, S. J. D. Anomaly Detection in Application Performance Monitoring Data. Retrieved from http://www.prelert.com/resources/Anomaly_Detection_In_APM_Data.pdf</span></li></ol>



    <p class=discuss>
        Discuss this post via <a href="mailto:bistaumanga@gmail.com">e-mail</a>
    </p>


</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'bistaumanga'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        

    </div>

      </div>
    </div>
    <div class=pure-u-1-5>
      <div class=author-info>
    <img src="/images/author-image.jpg" class=author-image />
    <h1 class=author-name><a href=/>Umanga Bista</a></h1>
    <div class=nav>
        <a href="https://github.com/bistaumanga"><i class="fa fa-github-alt fa-2x"></i></a>
        <a href="mailto:bistaumanga@gmail.com"><i class="fa fa-envelope fa-2x"></i></a>
        <a href="https://np.linkedin.com/in/bistaumanga"><i class="fa fa-linkedin-square fa-2x"></a></i>
        <a href="https://www.researchgate.net/profile/Umanga_Bista"><i class="fa fa-flask fa-2x"></i></a>
    </div>
    
    <p class=author-bio>Research Assistant at <a href=http://www.logpoint.com/>LogPoint</a>.<br>
Formerly, Computer Engineering undergrad at <a href=http://www.ioe.edu.np/>Institute of Engineering, Central Campus</a>.
</p>
    
</div>
    </div>
  </div>
  <script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bistaumanga'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

    
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>

    <script type="text/javascript">
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/platform.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>
  </body>

  <div class="top-bar pure-g">
      <div class=pure-u-1-2>
        <h3> Copyright @ <a href = "/">Umanga Bista</a></h3>
      </div>
      <div class=pure-u-1-2>
        
      </div>

  </html>
