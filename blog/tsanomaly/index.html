<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name=description content="Personal website and blog of Umanga Bista">


  <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <title>
    
    Robust Statistic based Streaming Anomaly Detection Scheme for Time-Series Data | 
    
    Umanga Bista

  </title>

  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
  </script>

  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50991800-1', 'bistaumanga.com.np');
  ga('send', 'pageview');

  </script>

  <link rel=stylesheet type=text/css href=/css/github.css>
  <link rel=stylesheet type=text/css href=/css/styles.css>
  <link rel=stylesheet type=text/css href=/css/highlight.css>

  

  </head>

  <body>

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">  
    <div class="container-fluid">

    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    <a class="navbar-brand visible-xs" href="/"><img src="http://s.gravatar.com/avatar/05710f1aef9f9b4aed9b61381cd625db?s=40" class="img-circle" /></a>
    <a class="navbar-brand hidden-xs" href="/">UMB</a>

    <div class="navbar-header visible-xs">
      <a type="button" class="navbar-toggle nav-link" href="https://github.com/bistaumanga" style="color:#000;">
        <i class="fa fa-github-square fa-lg"></i>
      </a>

      <a type="button" class="navbar-toggle nav-link" href="https://np.linkedin.com/in/bistaumanga" style="color:#007bb6;">
        <i class="fa fa-linkedin-square fa-lg"></i>
      </a>

      <a type="button" class="navbar-toggle nav-link" href="mailto:mail@bistaumanga.com.np" style="color:#6E329D;">
        <i class="fa fa-envelope fa-lg"></i>
      </a>
      
      </a>
    </div>

    </div>

    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class="active"><a href="/"><i class="fa fa-home fa-lg"></i></a></li>
        <li><a href="/publications">Publications</a></li>
        <li><a href="/blog">Blog</a></li>
      </ul>
    </div>
    

  </div>

  </nav>




    <div class="col-sm-3 sidebar hidden-xs" style = "height: 100%;">
        <header class="sidebar-header">
    <img src="http://s.gravatar.com/avatar/05710f1aef9f9b4aed9b61381cd625db?s=160" class="img-circle" />
    <h3><a href=/>Umanga Bista<br>(उमङ्ग बिष्ट)</a></h3>
</header>
<div style = "color:#8B7500;" align = center>  

 Machine learninng, Big data and Stream mining enthusiast

</div>
<br>
<div align=center>
    <div class="btn-group">
        <a class="btn btn-default btn-sm" href="https://github.com/bistaumanga" style="color:#000;" target="_blank">
            <i class="fa fa-github-alt fa-2x"></i>
        </a>
        <a class="btn btn-default btn-sm" href="https://np.linkedin.com/in/bistaumanga" style="color:#007bb6;" target="_blank">
            <i class="fa fa-linkedin-square fa-2x"></i>
        </a>
        <a class="btn btn-default btn-sm" href="mailto:mail@bistaumanga.com.np" style="color:#6E329D;" target="_blank">
            <i class="fa fa-envelope fa-2x"></i>
        </a>
    </div>
    <br><br>
    <a class="btn btn-default btn-sm" href="files/cv.pdf" style="color: #DC143C;align: center;" target="_blank"><i class="fa fa-download fa-lg"></i> CV</a>
    <br><br>
    <a class="btn btn-link btn-sm" href="https://db.tt/rJjB3Llm" style="color: #3d9ae8;align: center;" target="_blank"> <i class="fa fa-dropbox fa-lg"></i> Free Online Storage </a>

</div>
    </div>  

    <div class="col-xs-18 col-sm-9 col-sm-offset-3" style="padding:1em 1em 1em 2em;">    
      <div class=post>
    
    <ul class=post-meta>
    
        
    
    <li><i class="fa fa-calendar" style="color:#ff2288;"></i>May 13, 2014</li>
    
        <li><i class="fa fa-tag" style="color:#28c;"></i><a href="/tags/#robust-statistic,-ref">robust-statistic,</a></li>
    
        <li><i class="fa fa-tag" style="color:#28c;"></i><a href="/tags/#anomaly-detection,-ref">anomaly-detection,</a></li>
    
        <li><i class="fa fa-tag" style="color:#28c;"></i><a href="/tags/#time-series,-ref">time-series,</a></li>
    
        <li><i class="fa fa-tag" style="color:#28c;"></i><a href="/tags/#streaming-algorithm-ref">streaming-algorithm</a></li>
    
</ul>

    <h1 class=title-large>Robust Statistic based Streaming Anomaly Detection Scheme for Time-Series Data</h1>
    <div class=content>
        <br>
        <script src="//platform.linkedin.com/in.js" type="text/javascript">
        lang: en_US
        </script>
        <script type="IN/Share" data-counter="right"></script>
        <div class="g-plus" data-action="share" data-height="24"></div>
        <div class="fb-like" rel="canonical" data-href= "" data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>
        

        <p>Identifying the anomalous observations in time series data can be very important for <a href="http://en.wikipedia.org/wiki/Siem">SIEM</a> solutions. An example is a system that tracks the records of number of user-logins per minute. The anomalous entries in this case can be when the count becomes unexpecteadly higher or lower than normal trend.</p>

<p>This can be detected by simpler approach such as standard deviation method, i.e. an entry in time-series is anomaly when its not in range <strong>$ [\mu - k * \sigma, \mu + k * \sigma] $</strong>. The typical value of <strong>$ k $</strong> is <strong>3, 3.5, 4</strong>, which has to be set manually. There are three problems with this approach. The problems and the possible solutions are enumerated below:</p>

<div class="alert alert-danger" role="alert">the statistics $ \mu $ and $ \sigma $ both are not robust, outliers have huge affect on them.</div>

<blockquote>
  <p>We have to use roubust statistics such as <strong>$ M_d $</strong>:[Median], <strong>$ IQR $</strong> :[Inter Quartile Range], in favour of <strong>$ \mu $</strong> and <strong>$ \sigma $</strong>. The time series should be smoothened by <strong><a href="http://en.wikipedia.org/wiki/Causal_system">causal</a></strong> version of <strong>Moving Median</strong> or <strong>Causal 1-D Moving Median Filter</strong>.</p>
</blockquote>

<div class="alert alert-danger" role="alert">It does not captures the trend, i.e. What if the distribution of the time-series data is  multimodal.</div>

<blockquote>
  <p>We have to capture the trend. One way to do this is smooth the time series signal, and model the residual for anomaly detection. The residual will have $ \mu = 0 $ and some standard deviation.</p>
</blockquote>

<p><img src="/images/tsanomaly/residual_plot.png" alt="center" /></p>

<div class="alert alert-danger" role="alert">Anomalous time-series entries have to be identified in real-time, so we cannot use batch algorithms that calculates the parameters *$ \mu, \sigma $* in first pass and filters out the anomalous data in second pass. But this can be solved by streaming algorithm for $ \mu, \sigma $ <a href="#knuth2">(Knuth, 1998, p. 232)</a>.</div>

<blockquote>
  <p>But since we are using robust statistics <em>$ [M_d, IQR] $</em>, we have to use streaming version of that. Luckily, there exist an awesome algorithms for this : <strong>QDigest</strong> <a href="#qdigest">(Shrivastava, Buragohain, Agrawal, &amp; Suri, 2004)</a> and <strong>TDigest</strong> <a href="#tdigest">(Dunning, 2014)</a>.</p>
</blockquote>

<p>Using these concepts to decide whether a data from real-time is an anomaly or not, we first predict
the value using Causal Moving Median algorithm. Then the residual, which is a difference between predicted and observed value is used to compute the Streaming $ M_d,  IQR $. These Robust statistics are used to estimate the robust $ \mu , \sigma $ using Equations [<a href="http://en.wikipedia.org/wiki/Robust_measures_of_scale#Estimation">wiki : Robust Scale Estimation</a>]:</p>

<script type="math/tex; mode=display">
\mu = M_d \\
\sigma = 0.74 * IQR
</script>

<p>With these estimates for robust mean and standard deviation, we will calculate the two-tailed $p-value$ as :</p>

<script type="math/tex; mode=display"> p_{value} = 1 - Erf \frac{\mid residual - \mu  \mid}{\sqrt{2\sigma^2}} </script>

<p>and we can give the score to anomalous entries as <a href="#pvalprelert">(Veasey &amp; Dodson, n.d.)</a>:</p>

<script type="math/tex; mode=display"> anomaly\_score = - \log{p_{value}} </script>

<!--- So, Let us use overall Discussion to sketch an algorithm for real time Anomaly Detection in time-series data.
![png](/files/tsanomaly/algorithm.png) -->

<h2 id="results">Results</h2>
<p>Here are the results of algorithm for time series datasets with</p>

<h4 id="trend">Trend</h4>
<p><img src="/images/tsanomaly/trend.png" alt="center" /></p>

<h4 id="seasonality">Seasonality</h4>
<p><img src="/images/tsanomaly/sin.png" alt="center" /></p>

<h4 id="trend-and-seasonality">Trend and Seasonality</h4>
<p><img src="/images/tsanomaly/sintrend.png" alt="center" /></p>

<h4 id="level-shift">Level Shift</h4>
<p><img src="/images/tsanomaly/shift.png" alt="center" /></p>

<p>The results shows that the algorithm was able to detect the anomalous entries in a time series with trend or seasonality or both or Level shifts.</p>

<h2 id="references">References</h2>
<ol class="bibliography" style="font-size:12pt; text-align:left;"><li><span id="knuth2">Knuth, D. (1998). <i>The Art of Computer Programming</i> (3rd ed., Vol. II - Seminumerical Algorithms). Addison Wesley Longman. Retrieved from http://www.amazon.com/gp/product/0201896842/104-5257411-2220725?ie=UTF8&amp;tag=theende-20&amp;linkCode=xm2&amp;camp=1789&amp;creativeASIN=0201896842</span></li>
<li><span id="qdigest">Shrivastava, N., Buragohain, C., Agrawal, D., &amp; Suri, S. (2004). Medians and Beyond: New Aggregation Techniques for Sensor Networks. In <i>Proceedings of the 2Nd International Conference on Embedded Networked Sensor Systems</i> (pp. 239–249). New York, NY, USA: ACM. doi:10.1145/1031495.1031524</span></li>
<li><span id="tdigest">Dunning, T. (2014). Computing Extremely Accurate Quantiles Using t-Digests. Retrieved from https://github.com/tdunning/t-digest</span></li>
<li><span id="pvalprelert">Veasey, T. J., &amp; Dodson, S. J. Anomaly Detection in Application Performance Monitoring Data. Retrieved from http://www.prelert.com/resources/Anomaly_Detection_In_APM_Data.pdf</span></li></ol>



    <p class=discuss>
        Discuss this post via <a href="mailto:mail@bistaumanga.com.np">e-mail</a>
    </p>


</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'bistaumanga'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        

    </div>

    </div>



    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'bistaumanga'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>

    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>



    <script type="text/javascript">
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/platform.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>

 <div id="footer">
  <div class="row">
    <div class="col-sm-offset-4 col-xs-offset-2">
      <h5>
        <i class="fa fa-copyright fa-lg"></i>
        <a href = "/"> bistaumanga</a> 
        <i class="fa fa-code fa-lg" style="color:#000;"></i>
        Created with <a href = "http://jekyllrb.com/">Jekyll</a>, 
        <a href = "http://getbootstrap.com/">Bootstrap </a>
        <i class="fa fa-database fa-lg" style="color:#000;"></i>
        hosted @ <a href = "https://pages.github.com/">
        <i class="fa fa-github fa-lg"></i> </a> </h5>
    </div>
  </div>
</div>
 
</body>
</html>
