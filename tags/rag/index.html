<!DOCTYPE html>
<html lang="en">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>Umanga Bista - RAG</title>
                        <link rel="stylesheet" href="../../theme/css/main.css" />
                                <link href="https://bistaumanga.com.np/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Umanga Bista Atom Feed" />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><a href="../../">Umanga Bista</a></h1>
                        <nav><ul>
                                        <li><a href="/blog/">Blog</a></li>
                                                <li><a href="../../">Home</a></li>
                        </ul></nav>
                </header><!-- /#banner -->

                <aside id="featured" class="body">
                    <article>
                        <h1 class="entry-title"><a href="../../">Building Visual search with Dino-v3 and SIGLIP3 embeddings</a></h1>
<footer class="post-info">
        <abbr class="published" title="2026-01-21T10:00:00+11:00">
                Published: Wed 21 January 2026
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../../author/umanga-bista.html">Umanga Bista</a>
                </address>
        <p>In <a href="../../category/demo.html">demo</a>.</p>
<p>tags: <a href="../../tags/rag/">RAG</a> <a href="../../tags/search/">search</a> <a href="../../tags/embeddings/">embeddings</a> </p>        
</footer><!-- /.post-info --><h1>Building a Multimodal Visual Search System with DINO, SigLIP, and USearch</h1>
<p>This post walks through the core pieces of a modern visual search stack: image embeddings, text embeddings, fast indexing, and an interactive demo. The focus is on practical, minimal examples you can adapt to your own datasets.</p>
<h2>Image‑to‑Image Search with DINO and SigLIP</h2>
<p>Image‑to‑image search has a simple pattern:</p>
<ol>
<li>Encode a query image into an embedding vector.</li>
<li>Encode all dataset images into embeddings.</li>
<li>Retrieve nearest neighbors in embedding space.</li>
</ol>
<p>Below is a minimal example using Hugging Face Transformers for both DINO and SigLIP. DINO is strong for fine‑grained similarity; SigLIP is highly semantic and works well even when the visual match is not exact.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoImageProcessor</span><span class="p">,</span> <span class="n">AutoModel</span>

<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;mps&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">mps</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>

<span class="c1"># DINO v3</span>
<span class="n">dino_id</span> <span class="o">=</span> <span class="s2">&quot;facebook/dinov3-vits16plus-pretrain-lvd1689m&quot;</span>
<span class="n">dino_processor</span> <span class="o">=</span> <span class="n">AutoImageProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">dino_id</span><span class="p">)</span>
<span class="n">dino_model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">dino_id</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;query.jpg&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">dino_processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">inference_mode</span><span class="p">():</span>
    <span class="n">dino_outputs</span> <span class="o">=</span> <span class="n">dino_model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
    <span class="n">dino_embedding</span> <span class="o">=</span> <span class="n">dino_outputs</span><span class="o">.</span><span class="n">last_hidden_state</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># CLS token</span>

<span class="c1"># SigLIP2 (image encoder)</span>
<span class="n">siglip_id</span> <span class="o">=</span> <span class="s2">&quot;google/siglip2-base-patch16-naflex&quot;</span>
<span class="n">siglip_processor</span> <span class="o">=</span> <span class="n">AutoImageProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">siglip_id</span><span class="p">)</span>
<span class="n">siglip_model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">siglip_id</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">siglip_processor</span><span class="p">(</span><span class="n">images</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">inference_mode</span><span class="p">():</span>
    <span class="n">siglip_embedding</span> <span class="o">=</span> <span class="n">siglip_model</span><span class="o">.</span><span class="n">get_image_features</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
</code></pre></div>

<h2>Text‑to‑Image Search with SigLIP</h2>
<p>SigLIP provides aligned text and image embeddings, making text‑to‑image search straightforward: embed the text, then search against the image embeddings.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoProcessor</span><span class="p">,</span> <span class="n">AutoModel</span>

<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;mps&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">mps</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>

<span class="n">siglip_id</span> <span class="o">=</span> <span class="s2">&quot;google/siglip2-base-patch16-naflex&quot;</span>
<span class="n">processor</span> <span class="o">=</span> <span class="n">AutoProcessor</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">siglip_id</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">siglip_id</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;a dog catching a frisbee&quot;</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">processor</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">inference_mode</span><span class="p">():</span>
    <span class="n">text_embedding</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_text_features</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)</span>
</code></pre></div>

<h2>Accelerating Inference on Apple M‑Series (MPS)</h2>
<p>Apple Silicon users can get significant speedups by placing models on the MPS backend. The following pattern works across DINO and SigLIP:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModel</span>

<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;mps&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">mps</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;facebook/dinov3-vits16plus-pretrain-lvd1689m&quot;</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</code></pre></div>

<h2>bfloat16 vs float16 vs float32</h2>
<p>Precision choice is a trade‑off between numerical range, stability, and memory:</p>
<ul>
<li><strong>float16 (fp16)</strong>: 1 sign bit, 5 exponent bits, 10 mantissa bits. Range is limited compared to bf16/fp32, so it can overflow/underflow more easily. Memory is <strong>2 bytes</strong> per value.</li>
<li><strong>bfloat16 (bf16)</strong>: 1 sign bit, 8 exponent bits, 7 mantissa bits. It matches fp32’s exponent range (better dynamic range than fp16) but has less precision in the mantissa. Memory is <strong>2 bytes</strong> per value.</li>
<li><strong>float32 (fp32)</strong>: 1 sign bit, 8 exponent bits, 23 mantissa bits. Best precision and range, but uses <strong>4 bytes</strong> per value.</li>
</ul>
<p>Most modern vision‑language checkpoints (including DINO and SigLIP variants) are typically trained with <strong>mixed precision</strong> (fp16 or bf16 depending on hardware) while retaining fp32 master weights; the exact choice depends on the training stack and hardware. For inference, all three are commonly supported, but stability can vary across devices.</p>
<p>On Apple Silicon, half precision saves memory and improves throughput, but fp16 can be unstable for some models. In particular, DINO v3 yields NaNs with fp16 on M‑series GPUs, while bf16 and fp32 are stable.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModel</span>

<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;mps&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">mps</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;facebook/dinov3-vits16plus-pretrain-lvd1689m&quot;</span><span class="p">)</span>

<span class="c1"># Prefer bf16 over fp16 on Apple Silicon for stability</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">bfloat16</span><span class="p">)</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</code></pre></div>

<p>In short: <strong>bf16</strong> is typically stable on Apple Silicon, while <strong>fp16</strong> can fail with DINO v3 on M‑series GPUs.</p>
<h2>Indexing and searching with USearch</h2>
<p>USearch is a fast, lightweight vector index that works well on consumer hardware and supports half‑precision storage to save space. The snippet below builds an index and searches using a text query embedding (for text‑to‑image search):</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">usearch</span>

<span class="c1"># Assume image_embeddings is a NumPy array of shape [N, D]</span>
<span class="c1"># and text_embedding is a NumPy array of shape [D]</span>

<span class="n">index</span> <span class="o">=</span> <span class="n">usearch</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span>
    <span class="n">ndim</span><span class="o">=</span><span class="n">image_embeddings</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cos&quot;</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>  <span class="c1"># half precision storage for smaller index</span>
<span class="p">)</span>

<span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_embeddings</span><span class="p">)),</span> <span class="n">image_embeddings</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">text_embedding</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">text_embedding</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">top_ids</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">keys</span>
</code></pre></div>

<p>FAISS is another popular indexing library, but on Apple M‑series the setup encountered a segmentation fault when building half‑precision indexes with SQfp16. For Apple Silicon, USearch has been the more reliable option.</p>
<h2>Gradio Demo</h2>
<p>Gradio provides a quick way to demo image‑to‑image and text‑to‑image search with a clean UI. Here are screenshots from the demo:</p>
<p><img src="/files/001_visual_search/image-to-image.jpg" alt="Image to image search" width="80%" height="auto" /></p>
<p><img src="/files/001_visual_search/text-to-image.jpg" alt="Text to image search" width="80%" height="auto" /></p>
<p>These ideas are packaged into this project with a full implementation and demo UI: <a href="https://github.com/bistaumanga/visual_search_demo">Github link</a></p>
<hr>
<p><strong>Acknowledgment:</strong> This project and this blog post were developed with the help of GitHub Copilot and Gemini 3 Pro (via the Gemini Assist VSCode tool).</p>                    </article>
                </aside><!-- /#featured -->
                <section id="extras" class="body">
                                <div class="social">
                                        <h2>social</h2>
                                        <ul>
                                                        <li><a href="https://bistaumanga.com.np/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                                                        <li><a href="https://www.twitter.com/bistaumanga">Twitter</a></li>
                                                        <li><a href="https://github.com/bistaumanga">GitHub</a></li>
                                                        <li><a href="https://au.linkedin.com/in/bistaumanga">LinkedIn</a></li>
                                                        <li><a href="mailto:mail@bistaumanga.com.np">Email</a></li>
                                        </ul>
                                </div><!-- /.social -->
                </section><!-- /#extras -->

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->

                        <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                </footer><!-- /#contentinfo -->

        </body>
</html>